@page "/map"
@using System.Net.WebSockets
@rendermode InteractiveServer

<h3>Map</h3>

<div id="map" style="width:600px; height:500px;"></div>


@code {

    private ClientWebSocket rosSocket = new ClientWebSocket();
    private string base64MapImage = string.Empty;

    // Khởi tạo và đăng ký sự kiện
    protected override async Task OnInitializedAsync()
    {
        Console.WriteLine("Component Initialized");
        await ConnectRosbridge();
    }

    private async Task ConnectRosbridge()
    {
        try
        {
            Uri serverUri = new Uri("ws://192.168.137.218:9090");
            await rosSocket.ConnectAsync(serverUri, CancellationToken.None);



            // Start receiving messages

        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error connecting to Rosbridge: {ex.Message}");
        }
    }
    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            // Gọi hàm JavaScript để khởi tạo bản đồ
            JSRuntime.InvokeVoidAsync("initMap");
        }
    }

    [Inject]
    private IJSRuntime? JSRuntime { get; set; }
}
